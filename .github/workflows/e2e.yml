name: "Tests: E2E"

on:
  workflow_run:
    workflows: ['netlify/currency-exchange-application/deploy-preview']
    types:
      - succeed

env:
  GITHUB_PR_NUMBER: ${{github.event.pull_request.number}}

jobs:
#   tests_e2e_netlify_prepare:
#     name: Wait for deployment on Netlify
#     runs-on: ubuntu-latest
#     steps:
#       - name: Waiting for Netlify Preview
#         uses: josephduffy/wait-for-netlify-action@v1
#         id: wait-for-netflify-preview
#         with:
#           site_name: "currency-exchange-application"
#           max_timeout: 180

  tests_e2e_netlify:
#     needs: tests_e2e_netlify_prepare
    name: Run end-to-end tests on Netlify PR preview
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - name: install dependencies
        run: npm ci
      - name: install playwright browsers
        run: npx playwright install --with-deps
      - name: npm run test:e2e
        run: npm run test:e2e
        env:
          BASE_URL: "https://deploy-preview-${{env.GITHUB_PR_NUMBER}}--currency-exchange-application.netlify.app"
          DEBUG: pw:api
